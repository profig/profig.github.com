/// Knockout Mapping plugin v2.3.0
/// (c) 2012 Steven Sanderson, Roy Jacobs - http://knockoutjs.com/
/// License: MIT (http://www.opensource.org/licenses/mit-license.php)
(function(d){"function"===typeof require&&"object"===typeof exports&&"object"===typeof module?d(require("knockout"),exports):"function"===typeof define&&define.amd?define(["knockout","exports"],d):d(ko,ko.mapping={})})(function(d,e){function v(a,c){for(var b in c)if(c.hasOwnProperty(b)&&c[b])if(b&&a[b]&&"array"!==e.getType(a[b]))v(a[b],c[b]);else if("array"===e.getType(a[b])&&"array"===e.getType(c[b])){for(var d=a,g=b,j=a[b],l=c[b],i={},k=j.length-1;0<=k;--k)i[j[k]]=j[k];for(k=l.length-1;0<=k;--k)i[l[k]]=
l[k];j=[];l=void 0;for(l in i)j.push(i[l]);d[g]=j}else a[b]=c[b]}function B(a,c){var b={};v(b,a);v(b,c);return b}function y(a,c){options=B({},a);for(var b=J.length-1;0<=b;b--){var d=J[b];options[d]&&(options[""]instanceof Object||(options[""]={}),options[""][d]=options[d],delete options[d])}c&&(options.ignore=q(c.ignore,options.ignore),options.include=q(c.include,options.include),options.copy=q(c.copy,options.copy));options.ignore=q(options.ignore,h.ignore);options.include=q(options.include,h.include);
options.copy=q(options.copy,h.copy);options.mappedProperties=options.mappedProperties||{};return options}function q(a,c){"array"!==e.getType(a)&&(a="undefined"===e.getType(a)?[]:[a]);"array"!==e.getType(c)&&(c="undefined"===e.getType(c)?[]:[c]);return d.utils.arrayGetDistinctValues(a.concat(c))}function C(a,c,b,f,g,j){var l="array"===e.getType(d.utils.unwrapObservable(c)),j=j||"";if(e.isMapped(a))var i=d.utils.unwrapObservable(a)[r],b=B(i,b);var k=function(){return b[f]&&b[f].create instanceof Function},
H=function(a){var e=D,l=d.dependentObservable;d.dependentObservable=function(a,b,c){c=c||{};a&&"object"==typeof a&&(c=a);var f=c.deferEvaluation,K=!1;c.deferEvaluation=!0;a=new E(a,b,c);if(!f){var g=a,f=d.dependentObservable;d.dependentObservable=E;a=d.isWriteableObservable(g);d.dependentObservable=f;a=E({read:function(){K||(d.utils.arrayRemoveItem(e,g),K=!0);return g.apply(g,arguments)},write:a&&function(a){return g(a)},deferEvaluation:!0});e.push(a)}return a};d.dependentObservable.fn=E.fn;d.computed=
d.dependentObservable;a=d.utils.unwrapObservable(g)instanceof Array?b[f].create({data:a||c,parent:g,skip:L}):b[f].create({data:a||c,parent:g});d.dependentObservable=l;d.computed=d.dependentObservable;return a},h=function(){return b[f]&&b[f].update instanceof Function},w=function(a,e){var l={data:e||c,parent:g,target:d.utils.unwrapObservable(a)};d.isWriteableObservable(a)&&(l.observable=a);return b[f].update(l)};if(i=F.get(c))return i;f=f||"";if(l){var l=[],s=!1,m=function(a){return a};b[f]&&b[f].key&&
(m=b[f].key,s=!0);d.isObservable(a)||(a=d.observableArray([]),a.mappedRemove=function(b){var c=typeof b=="function"?b:function(a){return a===m(b)};return a.remove(function(a){return c(m(a))})},a.mappedRemoveAll=function(b){var c=z(b,m);return a.remove(function(a){return d.utils.arrayIndexOf(c,m(a))!=-1})},a.mappedDestroy=function(b){var c=typeof b=="function"?b:function(a){return a===m(b)};return a.destroy(function(a){return c(m(a))})},a.mappedDestroyAll=function(b){var c=z(b,m);return a.destroy(function(a){return d.utils.arrayIndexOf(c,
m(a))!=-1})},a.mappedIndexOf=function(b){var c=z(a(),m),b=m(b);return d.utils.arrayIndexOf(c,b)},a.mappedCreate=function(b){if(a.mappedIndexOf(b)!==-1)throw Error("There already is an object with the key that you specified.");var c=k()?H(b):b;if(h()){b=w(c,b);d.isWriteableObservable(c)?c(b):c=b}a.push(c);return c});var i=z(d.utils.unwrapObservable(a),m).sort(),o=z(c,m);s&&o.sort();var s=d.utils.compareArrays(i,o),i={},q,x=d.utils.unwrapObservable(c),u={},v=!0,o=0;for(q=x.length;o<q;o++){var p=m(x[o]);
if(void 0===p||p instanceof Object){v=!1;break}u[p]=x[o]}var x=[],y=0,o=0;for(q=s.length;o<q;o++){var p=s[o],n,t=j+"["+o+"]";switch(p.status){case "added":var A=v?u[p.value]:G(d.utils.unwrapObservable(c),p.value,m);n=C(void 0,A,b,f,a,t);k()||(n=d.utils.unwrapObservable(n));t=M(d.utils.unwrapObservable(c),A,i);n===L?y++:x[t-y]=n;i[t]=!0;break;case "retained":A=v?u[p.value]:G(d.utils.unwrapObservable(c),p.value,m);n=G(a,p.value,m);C(n,A,b,f,a,t);t=M(d.utils.unwrapObservable(c),A,i);x[t]=n;i[t]=!0;break;
case "deleted":n=G(a,p.value,m)}l.push({event:p.status,item:n})}a(x);b[f]&&b[f].arrayChanged&&d.utils.arrayForEach(l,function(a){b[f].arrayChanged(a.event,a.item)})}else if(N(c)){a=d.utils.unwrapObservable(a);if(!a){if(k())return s=H(),h()&&(s=w(s)),s;if(h())return w(s);a={}}h()&&(a=w(a));F.save(c,a);O(c,function(f){var e=j.length?j+"."+f:f;if(-1==d.utils.arrayIndexOf(b.ignore,e))if(-1!=d.utils.arrayIndexOf(b.copy,e))a[f]=c[f];else{var g=F.get(c[f]),l=C(a[f],c[f],b,f,a,e),g=g||l;if(d.isWriteableObservable(a[f]))a[f](d.utils.unwrapObservable(g));
else a[f]=g;b.mappedProperties[e]=!0}})}else switch(e.getType(c)){case "function":h()?d.isWriteableObservable(c)?(c(w(c)),a=c):a=w(c):a=c;break;default:if(d.isWriteableObservable(a))return n=h()?w(a):d.utils.unwrapObservable(c),a(n),n;a=k()?H():d.observable(d.utils.unwrapObservable(c))}return a}function M(a,c,b){for(var d=0,e=a.length;d<e;d++)if(!0!==b[d]&&a[d]===c)return d;return null}function P(a,c){var b;c&&(b=c(a));"undefined"===e.getType(b)&&(b=a);return d.utils.unwrapObservable(b)}function G(a,
c,b){for(var a=d.utils.unwrapObservable(a),f=0,e=a.length;f<e;f++){var j=a[f];if(P(j,b)===c)return j}throw Error("When calling ko.update*, the key '"+c+"' was not found!");}function z(a,c){return d.utils.arrayMap(d.utils.unwrapObservable(a),function(a){return c?P(a,c):a})}function O(a,c){if("array"===e.getType(a))for(var b=0;b<a.length;b++)c(b);else for(b in a)c(b)}function N(a){var c=e.getType(a);return("object"===c||"array"===c)&&null!==a}function R(){var a=[],c=[];this.save=function(b,f){var e=
d.utils.arrayIndexOf(a,b);0<=e?c[e]=f:(a.push(b),c.push(f))};this.get=function(b){b=d.utils.arrayIndexOf(a,b);return 0<=b?c[b]:void 0}}function Q(){var a={},c=function(b){var c;try{c=JSON.stringify(b)}catch(d){c="$$$"}b=a[c];void 0===b&&(b=new R,a[c]=b);return b};this.save=function(a,d){c(a).save(a,d)};this.get=function(a){return c(a).get(a)}}var r="__ko_mapping__",E=d.dependentObservable,I=0,D,F,J=["create","update","key","arrayChanged"],L={},u={include:["_destroy"],ignore:[],copy:[]},h=u;e.isMapped=
function(a){return(a=d.utils.unwrapObservable(a))&&a[r]};e.fromJS=function(a){if(0==arguments.length)throw Error("When calling ko.fromJS, pass the object you want to convert.");window.setTimeout(function(){I=0},0);I++||(D=[],F=new Q);var c,b;2==arguments.length&&(arguments[1][r]?b=arguments[1]:c=arguments[1]);3==arguments.length&&(c=arguments[1],b=arguments[2]);b&&(c=B(c,b[r]));c=y(c);var d=C(b,a,c);b&&(d=b);--I||window.setTimeout(function(){for(;D.length;){var a=D.pop();a&&a()}},0);d[r]=B(d[r],c);
return d};e.fromJSON=function(a){var c=d.utils.parseJson(a);arguments[0]=c;return e.fromJS.apply(this,arguments)};e.updateFromJS=function(){throw Error("ko.mapping.updateFromJS, use ko.mapping.fromJS instead. Please note that the order of parameters is different!");};e.updateFromJSON=function(){throw Error("ko.mapping.updateFromJSON, use ko.mapping.fromJSON instead. Please note that the order of parameters is different!");};e.toJS=function(a,c){h||e.resetDefaultOptions();if(0==arguments.length)throw Error("When calling ko.mapping.toJS, pass the object you want to convert.");
if("array"!==e.getType(h.ignore))throw Error("ko.mapping.defaultOptions().ignore should be an array.");if("array"!==e.getType(h.include))throw Error("ko.mapping.defaultOptions().include should be an array.");if("array"!==e.getType(h.copy))throw Error("ko.mapping.defaultOptions().copy should be an array.");c=y(c,a[r]);return e.visitModel(a,function(a){return d.utils.unwrapObservable(a)},c)};e.toJSON=function(a,c){var b=e.toJS(a,c);return d.utils.stringifyJson(b)};e.defaultOptions=function(){if(0<arguments.length)h=
arguments[0];else return h};e.resetDefaultOptions=function(){h={include:u.include.slice(0),ignore:u.ignore.slice(0),copy:u.copy.slice(0)}};e.getType=function(a){if(a&&"object"===typeof a){if(a.constructor==(new Date).constructor)return"date";if("[object Array]"===Object.prototype.toString.call(a))return"array"}return typeof a};e.visitModel=function(a,c,b){b=b||{};b.visitedObjects=b.visitedObjects||new Q;var f,g=d.utils.unwrapObservable(a);if(N(g))b=y(b,g[r]),c(a,b.parentName),f="array"===e.getType(g)?
[]:{};else return c(a,b.parentName);b.visitedObjects.save(a,f);var j=b.parentName;O(g,function(a){if(!(b.ignore&&-1!=d.utils.arrayIndexOf(b.ignore,a))){var i=g[a],k=b,h=j||"";"array"===e.getType(g)?j&&(h+="["+a+"]"):(j&&(h+="."),h+=a);k.parentName=h;if(!(-1===d.utils.arrayIndexOf(b.copy,a)&&-1===d.utils.arrayIndexOf(b.include,a)&&g[r]&&g[r].mappedProperties&&!g[r].mappedProperties[a]&&"array"!==e.getType(g)))switch(e.getType(d.utils.unwrapObservable(i))){case "object":case "array":case "undefined":k=
b.visitedObjects.get(i);f[a]="undefined"!==e.getType(k)?k:e.visitModel(i,c,b);break;default:f[a]=c(i,b.parentName)}}});return f}});
